{"version":3,"file":"emot.js","sources":["../src/main.js"],"sourcesContent":["function createElement(name, className) {\n  const dom = document.createElement(name)\n  if (className) dom.className = className\n  return dom\n}\n\nexport default class Emot {\n  #options\n  #output\n  #emotAll\n  constructor(options) {\n    this.#injectStyle()\n    this.#options = options\n    this.#options.el = document.querySelector(options.el)\n    this.#options.target = document.querySelector(options.target)\n    this.#output = { content: '', contentHTML: '' }\n    this.#emotAll = {}\n    this.#request(this.#options.emotMaps)\n  }\n  get() {\n    return this.#output\n  }\n\n  #init() {\n    const self = this\n\n    // 将所有的表情合并成一个\n    for (const e in self.#options.emotMaps) {\n      const type = self.#options.emotMaps[e].type\n      if (type === 'text') continue\n      const items = self.#options.emotMaps[e].items\n      self.#emotAll = Object.assign(self.#emotAll, items)\n    }\n\n    self.#createDOM()\n\n    // 监听目标(textarea)输入\n    self.#options.target.oninput = function () {\n      self.#output.content = this.value\n      self.#parseEmot()\n    }\n  }\n\n  // eslint-disable-next-line max-statements\n  #createDOM() {\n    const self = this\n    const root = createElement('div', 'emot')\n    const emotMaps = self.#options.emotMaps\n\n    const packages = createElement('div', 'emot-packages')\n    for (const emotKey in emotMaps) {\n      const emotValue = emotMaps[emotKey]\n      const ul = createElement('ul', 'emot-items')\n      ul.emotKey = emotKey\n      root.appendChild(ul)\n      // 表情选项卡分类\n      for (const iKey in emotValue.items) {\n        const iValue = emotValue.items[iKey]\n        const li = createElement('li', 'emot-item')\n        ul.appendChild(li)\n        li.onclick = function () {\n          // 获取输入框光标位置\n          let cursorStart = self.#options.target.selectionStart\n          let cursorEnd = self.#options.target.selectionEnd\n          const ctx = self.#output.content\n          const Start = ctx.substring(0, cursorStart)\n          const Ent = ctx.substring(cursorEnd)\n          if (emotValue.type === 'text') self.#output.content = Start + iValue + Ent\n          else self.#output.content = Start + '[' + iKey + ']' + Ent\n          self.#options.target.focus()\n          self.#options.target.value = self.#output.content\n          // 将光标指定到插入内容的后面\n          self.#options.target.selectionEnd = Ent ? self.#output.content.indexOf(Ent) : self.#output.content.length\n          // 重新解析表情\n          self.#parseEmot()\n        }\n\n        // 如果是问本类型这创建span，反之创建img\n        if (emotValue.type === 'text') {\n          const span = createElement('span')\n          span.title = iKey\n          span.textContent = iValue\n          li.appendChild(span)\n        } else {\n          const img = createElement('img')\n          img.src = iValue\n          img.title = img.alt = iKey\n          li.appendChild(img)\n        }\n      }\n\n      // 创建表情包选项卡\n      const pkgSpan = createElement('span')\n      pkgSpan.innerHTML = emotKey\n      pkgSpan.onclick = function () {\n        // 当点击表情选项卡时，清空所有表情选项卡的class属性\n        packages.childNodes.forEach((node) => {\n          node.className = ''\n        })\n        // 为当前点击的表情选项卡添加class属性\n        pkgSpan.className = 'emot-package-active'\n\n        // 选中的表情列表\n        root.querySelectorAll('.emot-items').forEach((node) => {\n          node.classList.remove('emot-items-active')\n          if (node.emotKey === emotKey) {\n            node.classList.add('emot-items-active')\n          }\n        })\n      }\n      packages.appendChild(pkgSpan)\n    }\n\n    // 默认选择第一个表情包选项卡\n    root.childNodes[0].classList.add('emot-items-active')\n    packages.childNodes[0].classList.add('emot-package-active')\n\n    root.appendChild(packages)\n    self.#options.el.appendChild(root)\n  }\n\n  #parseEmot() {\n    let ctx = this.#output.content\n    const emots = []\n    // 匹配所有[]格式的内容，并存储到emots数组中\n    ctx.replace(/\\[(.*?)\\]/g, ($0, $1) => {\n      emots.push($1)\n    })\n\n    // 遍历匹配到的所有[]格式的表情\n    for (const emot of emots) {\n      // 匹配是否包含在指定的表情当中\n      // 不包含直接直接进入下次循环\n      const link = this.#emotAll[emot]\n      if (!link) continue\n      const img = '<img src=' + link + ' alt=' + emot + '/>'\n      ctx = ctx.replace('[' + emot + ']', img)\n    }\n    this.#output.contentHTML = ctx\n  }\n\n  #injectStyle() {\n    const style = createElement('style')\n    /* eslint-disable max-len */\n    style.textContent =\n      '.emot{top:30px;width:100%;margin-top:10px;border:1px solid rgba(128,128,128,0.2);border-radius:4px;background:#fff;}.emot-items{display:none;height:180px;min-height:100px;max-height:200px;resize:vertical;padding:10px;margin:0;font-size:0;overflow-x:hidden;user-select:none;}.emot-items-active{display:block;}.emot-item{list-style-type:none;padding:5px 10px;border-radius:5px;display:inline-block;font-size:12px;line-height:14px;margin:0 10px 12px 0;cursor:pointer;transition:0.3s;}.emot-item img{width:32px;height:auto;}.emot-item:hover{background:rgba(128,128,128,0.2);box-shadow:0 2px 2px 0 rgb(0 0 0 / 14%),0 3px 1px -2px rgb(0 0 0 / 20%),0 1px 5px 0 rgb(0 0 0 / 12%);}.emot-packages{padding:0;font-size:0;border-top:solid 1px rgba(128,128,128,0.2);}.emot-packages span{display:inline-block;line-height:30px;font-size:14px;padding:0 10px;cursor:pointer;}.emot-packages:nth-child(1){border-radius:0 0 0 3px;}.emot-packages span img{width:20px;position:relative;top:5px;}.emot-package-active{background:rgba(128,128,128,0.2);}'\n    /* eslint-enable max-len */\n    document.head.appendChild(style)\n  }\n\n  #request(emotMaps) {\n    // 判断是否是.json结尾，如果是则发送请求\n    if (!/\\.json$/.test(emotMaps)) return this.#init()\n    const xhr = new XMLHttpRequest()\n    xhr.open('GET', emotMaps, true)\n    xhr.send()\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === 4) {\n        const isSuccess = xhr.status >= 200 && xhr.status < 300\n        if (isSuccess) {\n          this.#output.emotMaps = this.#options.emotMaps = JSON.parse(xhr.responseText)\n          this.#init()\n        } else {\n          // eslint-disable-next-line no-console\n          console.error('Emotion request failure:', xhr)\n        }\n      }\n    }\n  }\n}\n"],"names":["createElement","name","className","dom","document","_init2","self","this","e","_classPrivateFieldGet","_options","emotMaps","type","items","_classPrivateFieldSet","Object","assign","_emotAll","_classPrivateMethodGet","_createDOM","_createDOM2","target","oninput","_output","content","value","_parseEmot","_parseEmot2","call","root","packages","_loop","emotKey","emotValue","ul","appendChild","_loop2","iKey","iValue","li","onclick","cursorStart","selectionStart","cursorEnd","selectionEnd","ctx","Start","substring","Ent","focus","indexOf","length","span","title","textContent","img","src","alt","pkgSpan","innerHTML","childNodes","forEach","node","querySelectorAll","classList","remove","add","el","emots","replace","$0","$1","push","_i","_emots","emot","link","contentHTML","_injectStyle2","style","head","_this","test","_init","xhr","XMLHttpRequest","open","send","onreadystatechange","readyState","status","JSON","parse","responseText","console","error","Emot","options","_classCallCheck","_classPrivateMethodInitSpec","_request","_injectStyle","_classPrivateFieldInitSpec","writable","querySelector","_request2"],"mappings":"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"}